#include "usart.h"

// Written by Jamiexu

void usart_config(void)
{
    rcu_periph_clock_enable(RCU_USART0);
 
    usart_deinit(USART0);

    usart_baudrate_set(USART0, 115200);
    usart_word_length_set(USART0, USART_WL_8BIT);
    usart_stop_bit_set(USART0, USART_STB_1BIT);
    usart_parity_config(USART0, USART_PM_NONE);
    usart_baudrate_set(USART0, 115200U);
    usart_receive_config(USART0, USART_RECEIVE_ENABLE);
    usart_transmit_config(USART0, USART_TRANSMIT_ENABLE);
    usart_enable(USART0);
    // usart_dma_transmit_config(USART0, USART_TRANSMIT_DMA_ENABLE);
}

/* retarget the C library printf function to the USART */
int fputc(int ch, unsigned char *f)
{
    usart_data_transmit(USART0, (uint8_t) ch);
    while(RESET == usart_flag_get(USART0, USART_FLAG_TBE));
    return ch;
}
